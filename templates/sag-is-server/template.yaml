###############################################################################
# Copyright (c) 2011-2019 Software AG, Darmstadt, Germany and/or Software AG USA Inc., Reston, VA, USA, and/or its subsidiaries and/or its affiliates and/or their licensors.
#
# SPDX-License-Identifier: Apache-2.0
#
#   Licensed under the Apache License, Version 2.0 (the "License");
#   you may not use this file except in compliance with the License.
#   You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#   Unless required by applicable law or agreed to in writing, software
#   distributed under the License is distributed on an "AS IS" BASIS,
#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#   See the License for the specific language governing permissions and
#   limitations under the License.
#
###############################################################################
alias: sag-is-server
description: Integration Server core

environments:
  default:
    is.integrationserver.license.key: "*_PIE_10.*_*_*"  # IS license key
    is.instance.name:   default                         # Instance name
    is.primary.port:    5555                            # Primary port number
    is.diagnostic.port: 9999                            # Dialgnostic port number
    is.jmx.port:        8094                            # JMX port number
    is.memory.init:     128                             # Initial memory size
    is.memory.max:      256                             # Maximum memory size
    is.install.service: false
    is.fixes:
      - wMFix.integrationServer.ART
      - wMFix.integrationServer.Core
      - wMFix.integrationServer.FlatFile
      - wMFix.integrationServer.SPM
      - wMFix.jdbcAdapter
    
    is.instance.build.name:             "BUILD"
    is.instance.build.primary.port:     5555
    is.instance.build.diagnostic.port:  9955
    is.instance.build.jmx.port:         8055
    is.instance.build.memory.init:      256
    is.instance.build.memory.max:       256
    
    is.instance.test.name:              "TEST"
    is.instance.test.primary.port:      5566
    is.instance.test.diagnostic.port:   9966
    is.instance.test.jmx.port:          8066
    is.instance.test.memory.init:       256
    is.instance.test.memory.max:          256

    is.instance.sit.name:               "SIT"
    is.instance.sit.primary.port:       5577
    is.instance.sit.diagnostic.port:    9977
    is.instance.sit.jmx.port:           8077
    is.instance.sit.memory.init:        256
    is.instance.sit.memory.max:         256

layers:
  runtime:
    productRepo: ${repo.product}
    fixRepo:     ${repo.fix}
    templates:
      - spm-tuneup
      - is-server        

templates:
  spm-tuneup:
    description: SPM customizations
    fixes: [wMFix.SPM]
    products:
      SPM:

  is-server:
    licenses:
      "IntegrationServer/config/licenseKey.xml": "${is.integrationserver.license.key}"
    fixes: ${is.fixes}
    products:
      ACDLDeployerSharedBundle:
      Deployer:
      GWM_IS:
      GWMCommonLibs:
      jdbcAdapter:
      integrationServer:
        ${is.instance.build.name}:
          primary.port:    ${is.instance.build.primary.port}
          diagnostic.port: ${is.instance.build.diagnostic.port}
          jmx.port:        ${is.instance.build.jmx.port}
          license.file:    IntegrationServer/config/licenseKey.xml
          install.service: ${is.install.service}
          package.list:    WmBrokerDeployer, WmNUMDeployer, WmDeployer
          configuration:
            OSGI-IS_${is.instance.build.name}:
              COMMON-MEMORY:
                COMMON-MEMORY:
                  InitSize: ${is.instance.build.memory.init}
                  MaxSize:  ${is.instance.build.memory.max}
            integrationServer-${is.instance.build.name}:
            
        ${is.instance.test.name}:
          primary.port:    ${is.instance.test.primary.port}
          diagnostic.port: ${is.instance.test.diagnostic.port}
          jmx.port:        ${is.instance.test.jmx.port}
          license.file:    IntegrationServer/config/licenseKey.xml
          install.service: ${is.install.service}
          package.list:    WmServiceMock
          configuration:
            OSGI-IS_${is.instance.test.name}:
              COMMON-MEMORY:
                COMMON-MEMORY:
                  InitSize: ${is.instance.test.memory.init}
                  MaxSize:  ${is.instance.test.memory.max}
            integrationServer-${is.instance.test.name}:
            
        ${is.instance.sit.name}:
          primary.port:    ${is.instance.sit.primary.port}
          diagnostic.port: ${is.instance.sit.diagnostic.port}
          jmx.port:        ${is.instance.sit.jmx.port}
          license.file:    IntegrationServer/config/licenseKey.xml
          install.service: ${is.install.service}
          package.list:    WmJDBCAdapter
          configuration:
            OSGI-IS_${is.instance.sit.name}:
              COMMON-MEMORY:
                COMMON-MEMORY:
                  InitSize: ${is.instance.sit.memory.init}
                  MaxSize:  ${is.instance.sit.memory.max}
            integrationServer-${is.instance.sit.name}:

provision:
  default:
    runtime: ${nodes}
